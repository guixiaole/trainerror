<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" th:href="@{/css/table.css}" />
    <script th:src="@{js/index.js}" th:inline="javascript"></script>
    <script th:src="@{js/jquery.js}"></script>
    <title>train</title>
  </head>

  <body>
  <div
          class="video_div"
          style="
        display: none;
        position: absolute;
        right: 0px;
        top: 50px;
        height: 420px;
        width: 600px;
      "
  >
      <span
              style="
          background: url(../images/x.png) no-repeat;
          background-size: 100%;
          display: block;
          width: 40px;
          height: 40px;
          position: relative;
          float: right;
        "
              onclick="close_video()"
      ></span>
    <video
            src="../images/剧情2.mp4"
            controls="controls"
            height="400px"
            width="600px"
            class="step_video"
            id="video_play"
    ></video>
  </div>
    <div class="info_soft clearfix">
      <span>整备数据分析系统（2021年3月20版）</span>
    </div>
    <div class="nav clearfix">
      <div class="nav_div"><span>系统设置</span></div>
      <div class="dropdown">
        <span class="showtime nav_div">显示时间</span>
        <div class="dropdown-content">
          <a href="/showTimeIndex?time=1">显示1小时内</a>
          <a href="/showTimeIndex?time=5">显示5小时内</a>
          <a href="/showTimeIndex?time=12">显示12小时内</a>
          <a href="/showTimeIndex?time=24">显示24小时内</a>
          <a href="/showTimeIndex?time=3">显示3天内</a>
          <a href="/showTimeIndex?time=7">显示7天内</a>
          <a href="/showTimeIndex?time=30">显示一个月内</a>
        </div>
      </div>
      <div class="dropdown">
        <span class="nav_div">机统6与报错</span>
        <div class="dropdown-content">
          <a href="#">人工提报机统6</a>
          <a href="#" id ="baohuo">智能报活</a>
        </div>
      </div>
      <div class="nav_div"><span>在线升级</span></div>
      <div class="nav_div"><span>显示界面设置</span></div>
      <div class="nav_div"><span>使用说明书</span></div>
    </div>
    <!-- 中间各种操作 -->
    <div class="midselect clearfix">
      <a href="#"><span style="background-color: #a3a0f9">普通</span></a>
      <a href="#" onclick="getquancheng()" ><span style="width: 150px">全程记录</span></a>
      <a href="#" onclick="getquxian()"><span style="width: 150px">曲线记录</span></a>
      <a href="#" onclick="tishiandguide()"><span style="width: 150px">提示与指导</span></a>

      <a href="#"><span class="select_span" id ="step1">1</span></a>
      <a href="#"><span class="select_span" id ="step2">2</span></a>
      <a href="#"><span class="select_span" id ="step3">3</span></a>
      <a href="#"><span class="select_span" id ="step4">4</span></a>
      <a href="#"><span class="select_span" id ="step5">5</span></a>
      <a href="#"><span style="width: 150px">预报活</span></a>
      <a href="/index"><span style="width: 150px">新文件显示</span></a>
    </div>
<!--  <input type="hidden" id="stepanalysis" th:value="${stepAnalysis}" />-->
    <!-- 存放表格 -->
  <div id="show_execl" class="show_excel">

<!--    <a th:href="@{/oldNameDownload?filename=}+${fileinfo.oldFileName}+'&id='+${fileinfo.id}" onclick="download_origin_file()">下载原始文件</a>-->
<!--    <a th:href="@{/oldNameDownload?filename=}+${fileinfo.fileName}+'&id='+${fileinfo.id}"onclick="download_excle_file()">下载excle文件</a>-->
    <a href="#" onclick="download_origin_file()">下载原始文件</a>
    <a href="#" onclick="download_excle_file()">下载excle文件</a>
    <span class="origin_file_name"></span>
    <span onclick="cancleShow()"style="cursor: pointer;">取消</span>
  </div>
<!--  此部分为点击预报活而开始的页面-->
  <div class="yubaohuo" id="yubaohuo" style="display: none">
    <div class="jixing_baohuo">
      <div class="jixing_input">
        <div class="input_span">
          <span>机型</span><input type="text" name=""  />
        </div>
        <div class="input_span">
          <span>车号</span><input type="text" name=""  />
        </div>
      </div>
      <span class="piliangcheci">批量车次</span>
    </div>

    <div class="res_date">
      <div>预报活有效期</div>
      <input type="datetime-local" name="" />
      <input type="datetime-local" name=""  />
    </div>

    <div>预报活内容</div>
    <input
            type="text"
            name=""

            class="baohuo_text"
            placeholder="50个汉字、大小写英文、符号"
    />
    <div class="shenhe_div">
      <div style="float: left">预报活审核码</div>
      <input style="float: left" type="text" placeholder="1-5位数字" />
    </div>
    <div class="btn_last">
      <input type="button" value="确认" class="btn_baohuo" />
      <span>历史预报活</span>
      <span>撤销预报活</span>
    </div>
  </div>
    <div class="table-box">
      <table cellpadding="0" cellspacing="0">
        <thead>
          <tr>
            <th>序号</th>
            <th>整备点</th>
            <th style="width: 130px">文件起时</th>
            <th>车次</th>
            <th>机型</th>
            <th>车号</th>
            <th>司机名</th>
            <th>副司机名</th>
            <th>文件状态</th>
            <th>版本状态</th>
            <th>作业分</th>
            <th style="width: 130px">上传时间</th>
          </tr>
        </thead>

        <tbody id = "tbody">
          <tr th:each="fileinfo,state :${fileInfos}" th:onclick="'javascript:quanchengxiazai('+${state.index}+')'" ondblclick="quancheng(this.id)"  th:id="${fileinfo.id}">

            <td style="background-color: #e1e1e1">[[${state.index}]]</td>
            <td style="background-color: #e1e1e1">[[${fileinfo.zhuangBeiDian}]]</td>
            <td class="uploadformat">[[${startTime[state.index]}]]</td>
            <td>[[${fileinfo.cheCi}]]</td>
            <td>[[${fileinfo.jiXing}]]</td>
            <td>[[${fileinfo.cheHao}]]</td>
            <td>[[${fileinfo.siJiName}]]</td>
            <td>[[${fileinfo.fuSiJiName}]]</td>
            <td>[[${fileinfo.fileState}]]</td>
            <td></td>
            <td>[[${fileinfo.testScore}]]</td>
            <td class="timeformat">[[${uploadTime[state.index]}]]</td>
          </tr>
        </tbody>
        <!-- 
        <tfoot>
          <tr>
            <td colspan="5">
              【table，thead，tbody，tfoot】 colspan：合并行， rowspan：合并列
            </td>
          </tr>
        </tfoot> -->
      </table>
      <div class="rightbox">
        <div class="baocuo">
          <span class="baocuo_title">报错与质量情况分析</span>
          <div class="btn_select">
            <button></button>
            <button></button>
            <button></button>
            <button></button>

          </div>
          <div class="select_bao">
            <span class="undo"></span>
            <span class="select_redo">重做</span>
            <span class="select_redo">报活</span>
          </div>
        </div>
        <div class="file_select">
          <span class="file_span">文件查询</span>
          <form th:action="@{/searchFile}" method="post">
            <div class="input_select">
              <span>司机号：</span><input type="text" name="siJiName"/>
            </div>
            <div class="input_select">
              <span>机型：</span><input type="text" name="jiXing"/>
            </div>
            <div class="input_select">
              <span>车次：</span><input type="text" name="cheCi" />
            </div>
            <div class="input_select">
              <span>司机名：</span><input type="text" name="siJiName" />
            </div>
            <div class="input_select">
              <span>车号：</span><input type="text" name="cheHao" />
            </div>
            <button class="btn_confirm">确认</button>
          </form>
        </div>
        <div class="history_select">
          <input type="text" />
          <input type="text" />
          <input type="text" />
          <input type="text" />
          <button class="btn_history">查询</button>
        </div>
      </div>
    </div>



  <script type="text/javascript" th:inline="javascript">
    var height = window.screen.availHeight
    var tbody = document.getElementById('tbody')
    tbody.style.height = height - 100 + 'px'
    //修改tbody的高度
    var elevideo = document.getElementById('video_play')
    var step1 = document.getElementById('step1')
    var step2 = document.getElementById('step2')
    var step3 = document.getElementById('step3')
    var step4= document.getElementById('step4')
    var step5 = document.getElementById('step5')
    var fileinfos = [[${fileInfos}]]
    var stepanalysis = [[${stepAnalysis}]]



      let flag_step = 0
      if(stepanalysis.fiveStep!=null){
        var  five =[[${five}]]
        if (five.xiangDianId!=null){
          step5.style.backgroundColor="red"
        }else {
          step5.style.backgroundColor="#38f"
          flag_step=5
        }
      }
      if(stepanalysis.fourStep !=null){
        var  four =[[${four}]]
        if (four.xiangDianId!=null){
          step4.style.backgroundColor="red"
        }else {
          step4.style.backgroundColor="#38f"
          flag_step=4
        }
      }
      if(stepanalysis.threeStep!=null){
        var  three =[[${three}]]
        if (three.xiangDianId!=null){
          step3.style.backgroundColor="red"
        }else {
          step3.style.backgroundColor="#38f"
          flag_step=3
        }
      }

    if(stepanalysis.twoStep!=null){
          var  two =[[${two}]]
          if (two.xiangDianId!=null){
            step2.style.backgroundColor="red"
          }else {
            step2.style.backgroundColor="#38f"
            flag_step=2
          }
        }

      if (stepanalysis!=null){
        if(stepanalysis.oneStep!=null){
          var  one =[[${one}]]
          if (one.xiangDianId!=null){
            step1.style.backgroundColor="red"
          }else {
            step1.style.backgroundColor="#38f"
            flag_step=1
          }
        }
        if (flag_step>0){
          let video_div = document.getElementsByClassName('video_div')[0]
          video_div.style.display = 'block'
          if (flag_step==1){
            elevideo.src= "../images/1.mp4"
          }else if(flag_step==2){
            elevideo.src= "../images/2.mp4"
          }else if(flag_step==3){
            elevideo.src= "../images/3.mp4"
          }else if(flag_step==4){
            elevideo.src= "../images/4.mp4"
          }else {
            elevideo.src= "../images/5.mp4"
          }
        }
      }
    elevideo.addEventListener(
            'ended',
            function () {
              //结束
              var video_div = document.getElementsByClassName('video_div')[0]
              video_div.style.display = 'none'
              // console.log('播放结束')
            },
            false
    )
    function close_video() {
      var video_div = document.getElementsByClassName('video_div')[0]
      video_div.style.display = 'none'
      elevideo.pause()
    }
    function quancheng(id) {
      window.location="../quancheng?id="+id;
    }
    var originName=''
    var fileName = ''
    var fileIdDownload = ''
    function quanchengxiazai(index) {
      var show = document.getElementsByClassName('show_excel')[0]
      show.style.display = 'block'
      var spaninntext = document.getElementsByClassName('origin_file_name')[0]
      originName= fileinfos[index].oldFileName
      fileName = fileinfos[index].fileName

      fileIdDownload = fileinfos[index].id
      spaninntext.innerText = originName
    }
    function download_origin_file(){
      window.location = '../oldNameDownload?filename='+originName+'&id='+fileIdDownload

    }
    function download_excle_file(){
      window.location = '../oldNameDownload?filename='+fileName+'&id='+fileIdDownload

    }
      var fileinfo0 = [[${fileinfo0}]]
      function getquancheng(){
      //跳转到全程文件中去
        if (fileinfo0!=null){
            window.location="../quancheng?id="+fileinfo0.id;
        }else {
          alert("还没有选中文件")
        }
      }
      function getquxian(){
        if (fileinfo0!=null){
          window.location="../quxianIndex?id="+fileinfo0.id;
        }else {
          alert("还没有选中文件")
        }
      }
      function cancleShow(){
        //下载execl的取消界面
        var show = document.getElementsByClassName('show_excel')[0]
        show.style.display = 'none'
      }

    function e(obj) {
      return document.getElementById(obj)
    }
    e('baohuo').onclick = function (event) {
      e('yubaohuo').style.display = 'block'
      console.log(e('yubaohuo').style.display)
      stopBubble(event)
      document.onclick = function () {
        e('yubaohuo').style.display = 'none'
        document.onclick = null
      }
    }

    e('yubaohuo').onclick = function (event) {
      //只阻止了向上冒泡，而没有阻止向下捕获，所以点击con的内部对象时，仍然可以执行这个函数
      stopBubble(event)
    }
    //阻止冒泡函数
    function stopBubble(e) {
      if (e && e.stopPropagation) {
        e.stopPropagation() //w3c
      } else {
        window.event.cancelBubble = true //IE
      }
    }
      function tishiandguide(){
        //提示与指导进行
      }
  </script>
  </body>
</html>
